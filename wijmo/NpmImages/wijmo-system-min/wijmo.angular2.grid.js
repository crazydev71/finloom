/*
    *
    * Wijmo Library 5.20172.359
    * http://wijmo.com/
    *
    * Copyright(c) GrapeCity, Inc.  All rights reserved.
    *
    * Licensed under the GrapeCity Commercial License.
    * sales@wijmo.com
    * wijmo.com/products/wijmo-5/license/
    *
    */
System.register(["wijmo/wijmo.grid","wijmo/wijmo","@angular/core","@angular/common","@angular/forms","wijmo/wijmo.angular2.directiveBase"],function(n,t){"use strict";function w(){var n,t;return(n=window.wijmo)&&(t=n.grid)&&t.detail}function d(){var n;return(n=window.wijmo)&&n.input}var p=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),tt=t&&t.id,f,e,v,i,u,g,nt,s,l,h,a,c,o,r,b,k,y;return{setters:[function(n){f=n},function(n){e=n},function(n){v=n;i=n;u=n},function(n){g=n},function(n){nt=n},function(n){s=n}],execute:function(){n("wjFlexGridMeta",l={selector:'wj-flex-grid',template:"<div><ng-content></ng-content></div>",inputs:['wjModelProperty','isDisabled','newRowAtTop','allowAddNew','allowDelete','allowDragging','allowMerging','allowResizing','allowSorting','autoSizeMode','autoGenerateColumns','childItemsPath','groupHeaderFormat','headersVisibility','showSelectedHeaders','showMarquee','itemFormatter','isReadOnly','imeEnabled','mergeManager','selectionMode','showGroups','showSort','showDropDown','showAlternatingRows','showErrors','validateEdits','treeIndent','itemsSource','autoClipboard','frozenRows','frozenColumns','deferResizing','sortRowIndex','stickyHeaders','preserveSelectedState','preserveOutlineState','keyActionTab','keyActionEnter','rowHeaderPath','virtualizationThreshold',],outputs:['initialized','gotFocusNg: gotFocus','lostFocusNg: lostFocus','beginningEditNg: beginningEdit','cellEditEndedNg: cellEditEnded','cellEditEndingNg: cellEditEnding','prepareCellForEditNg: prepareCellForEdit','formatItemNg: formatItem','resizingColumnNg: resizingColumn','resizedColumnNg: resizedColumn','autoSizingColumnNg: autoSizingColumn','autoSizedColumnNg: autoSizedColumn','draggingColumnNg: draggingColumn','draggingColumnOverNg: draggingColumnOver','draggedColumnNg: draggedColumn','sortingColumnNg: sortingColumn','sortedColumnNg: sortedColumn','resizingRowNg: resizingRow','resizedRowNg: resizedRow','autoSizingRowNg: autoSizingRow','autoSizedRowNg: autoSizedRow','draggingRowNg: draggingRow','draggingRowOverNg: draggingRowOver','draggedRowNg: draggedRow','deletingRowNg: deletingRow','deletedRowNg: deletedRow','loadingRowsNg: loadingRows','loadedRowsNg: loadedRows','rowEditStartingNg: rowEditStarting','rowEditStartedNg: rowEditStarted','rowEditEndingNg: rowEditEnding','rowEditEndedNg: rowEditEnded','rowAddedNg: rowAdded','groupCollapsedChangedNg: groupCollapsedChanged','groupCollapsedChangingNg: groupCollapsedChanging','itemsSourceChangedNg: itemsSourceChanged','selectionChangingNg: selectionChanging','selectionChangedNg: selectionChanged','scrollPositionChangedNg: scrollPositionChanged','updatingViewNg: updatingView','updatedViewNg: updatedView','updatingLayoutNg: updatingLayout','updatedLayoutNg: updatedLayout','pastingNg: pasting','pastedNg: pasted','pastingCellNg: pastingCell','pastedCellNg: pastedCell','copyingNg: copying','copiedNg: copied',],providers:[{provide:nt.NG_VALUE_ACCESSOR,useFactory:s.WjValueAccessorFactory,multi:!0,deps:['WjComponent']}]});h=function(n){function t(t,i,r,u){var f=n.call(this,s.WjDirectiveBehavior.getHostElement(t,i))||this,o;return f.isInitialized=!1,o=f._wjBehaviour=s.WjDirectiveBehavior.attach(f,t,i,r),new b(f,u),f.deferUpdate(function(){if(f.rows.defaultSize<10){var t=f.hostElement,i=getComputedStyle(t),r=getComputedStyle(document.body),n=parseInt(i.fontSize&&e.contains(document.body,t)?i.fontSize:r.fontSize)*2;f.rows.defaultSize=n;f.columns.defaultSize=n*4;f.columnHeaders.rows.defaultSize=n;f.rowHeaders.columns.defaultSize=Math.round(n*1.25)}}),f.created(),f}return p(t,n),t.prototype.created=function(){},t.prototype.ngOnInit=function(){this._wjBehaviour.ngOnInit()},t.prototype.ngAfterViewInit=function(){this._wjBehaviour.ngAfterViewInit()},t.prototype.ngOnDestroy=function(){this._wjBehaviour.ngOnDestroy()},t.prototype.addEventListener=function(t,i,r,u){var o=this,f,e;u===void 0&&(u=!1);f=s.WjDirectiveBehavior;e=f.ngZone;e&&f.outsideZoneEvents[i]?e.runOutsideAngular(function(){n.prototype.addEventListener.call(o,t,i,r,u)}):n.prototype.addEventListener.call(this,t,i,r,u)},t}(f.FlexGrid);h.meta={outputs:l.outputs};h.decorators=[{type:v.Component,args:[{selector:l.selector,template:l.template,inputs:l.inputs,outputs:l.outputs,providers:[{provide:'WjComponent',useExisting:i.forwardRef(function(){return h})}].concat(l.providers)},]},];h.ctorParameters=function(){return[{type:i.ElementRef,decorators:[{type:u.Inject,args:[i.ElementRef,]},]},{type:i.Injector,decorators:[{type:u.Inject,args:[i.Injector,]},]},{type:undefined,decorators:[{type:u.Inject,args:['WjComponent',]},{type:u.SkipSelf},{type:i.Optional},]},{type:u.ChangeDetectorRef,decorators:[{type:u.Inject,args:[u.ChangeDetectorRef,]},]},]};n("WjFlexGrid",h);n("wjFlexGridColumnMeta",a={selector:'wj-flex-grid-column',template:"<div><ng-content></ng-content></div>",inputs:['asyncBindings','wjProperty','name','dataMap','dataType','binding','sortMemberPath','format','header','width','maxLength','minWidth','maxWidth','align','allowDragging','allowSorting','allowResizing','allowMerging','aggregate','isReadOnly','cssClass','isContentHtml','isSelected','visible','wordWrap','mask','inputType','isRequired','showDropDown','dropDownCssClass',],outputs:['initialized','isSelectedChangePC: isSelectedChange',],providers:[]});c=function(n){function t(t,i,r){var u=n.call(this)||this,e,f;return u.isInitialized=!1,u.wjProperty='columns',e=u._wjBehaviour=s.WjDirectiveBehavior.attach(u,t,i,r),f=e.parentBehavior.directive,f.autoGenerateColumns&&(f.autoGenerateColumns=!1,f.columns.clear()),u.created(),u}return p(t,n),t.prototype.created=function(){},t.prototype.ngOnInit=function(){this._wjBehaviour.ngOnInit()},t.prototype.ngAfterViewInit=function(){this._wjBehaviour.ngAfterViewInit()},t.prototype.ngOnDestroy=function(){this._wjBehaviour.ngOnDestroy()},t}(f.Column);c.meta={outputs:a.outputs,changeEvents:{'grid.selectionChanged':['isSelected']}};c.decorators=[{type:v.Component,args:[{selector:a.selector,template:a.template,inputs:a.inputs,outputs:a.outputs,providers:[{provide:'WjComponent',useExisting:i.forwardRef(function(){return c})}].concat(a.providers)},]},];c.ctorParameters=function(){return[{type:i.ElementRef,decorators:[{type:u.Inject,args:[i.ElementRef,]},]},{type:i.Injector,decorators:[{type:u.Inject,args:[i.Injector,]},]},{type:undefined,decorators:[{type:u.Inject,args:['WjComponent',]},{type:u.SkipSelf},{type:i.Optional},]},]};n("WjFlexGridColumn",c);o=function(){function n(n,t,i,r,u,f,e){this.viewContainerRef=n;this.templateRef=t;this.elRef=i;this.domRenderer=u;this.cdRef=e;this.autoSizeRows=!0;r instanceof h?this.grid=r:r instanceof c&&(this.column=r,this.grid=s.WjDirectiveBehavior.getBehavior(r).parentBehavior.directive)}return n._getTemplContextProp=function(n){return'$__cellTempl'+r[n]},n.prototype.ngOnInit=function(){this.ownerControl=this.column&&this.column.grid===this.grid?this.column:this.grid;this._attachToControl()},n.prototype.ngOnDestroy=function(){this.cellTypeStr&&(this.viewContainerRef.clear(),this.ownerControl[n._getTemplContextProp(this.cellType)]=null,this.grid.invalidate())},n.prototype._instantiateTemplate=function(n){return s.WjDirectiveBehavior.instantiateTemplate(n,this.viewContainerRef,this.templateRef,this.domRenderer)},n.prototype._attachToControl=function(){this.cellTypeStr&&(this.cellType=e.asEnum(this.cellTypeStr,r),this.ownerControl[n._getTemplContextProp(this.cellType)]=this,this.grid.invalidate())},n}();o.decorators=[{type:i.Directive,args:[{selector:'[wjFlexGridCellTemplate]',inputs:['wjFlexGridCellTemplate','cellTypeStr: cellType','cellOverflow','valuePaths','autoSizeRows'],exportAs:'wjFlexGridCellTemplate',providers:[{provide:'WjComponent',useExisting:i.forwardRef(function(){return o})}]},]},];o.ctorParameters=function(){return[{type:i.ViewContainerRef,decorators:[{type:u.Inject,args:[i.ViewContainerRef,]},]},{type:i.TemplateRef,decorators:[{type:u.Inject,args:[i.TemplateRef,]},{type:i.Optional},]},{type:i.ElementRef,decorators:[{type:u.Inject,args:[i.ElementRef,]},]},{type:undefined,decorators:[{type:u.Inject,args:['WjComponent',]},{type:u.SkipSelf},{type:i.Optional},]},{type:i.Renderer,decorators:[{type:u.Inject,args:[i.Renderer,]},]},{type:i.Injector,decorators:[{type:u.Inject,args:[i.Injector,]},]},{type:u.ChangeDetectorRef,decorators:[{type:u.Inject,args:[u.ChangeDetectorRef,]},]},]};n("WjFlexGridCellTemplate",o),function(n){n[n.Cell=0]="Cell";n[n.CellEdit=1]="CellEdit";n[n.ColumnHeader=2]="ColumnHeader";n[n.RowHeader=3]="RowHeader";n[n.RowHeaderEdit=4]="RowHeaderEdit";n[n.TopLeft=5]="TopLeft";n[n.GroupHeader=6]="GroupHeader";n[n.Group=7]="Group";n[n.NewCellTemplate=8]="NewCellTemplate";n[n.ColumnFooter=9]="ColumnFooter";n[n.BottomLeft=10]="BottomLeft"}(r||(r={}));n("CellTemplateType",r);b=function(n){function t(i,u){var f=n.call(this)||this,s,e;if(f._needsCdCheck=!1,f._lastApplyTimeStamp=0,f._noApplyLag=!1,f._startingEditing=!1,f._cellStampCounter=0,f._composing=!1,f.grid=i,f._gridCdRef=u,!t._templateTypes){t._templateTypes=[];for(s in r)isNaN(s)&&t._templateTypes.push(s)}return e=f,f._baseCf=i.cellFactory,i.cellFactory=f,f._evtInput=document.createEvent('HTMLEvents'),f._evtInput.initEvent('input',!0,!1),f._evtBlur=document.createEvent('HTMLEvents'),f._evtBlur.initEvent('blur',!1,!1),i.prepareCellForEdit.addHandler(function(){e._noApplyLag=!0}),i.cellEditEnded.addHandler(function(n,t){(t.range.col<0||t.range.col<i.columns.length&&!i.columns[t.range.col][o._getTemplContextProp(r.CellEdit)])&&(e._editChar=null);setTimeout(function(){e._noApplyLag=!1},300)}),i.beginningEdit.addHandler(function(){e._startingEditing=!0}),i.hostElement.addEventListener('keydown',function(){e._startingEditing=!1},!0),i.hostElement.addEventListener('keypress',function(n){var t=n.charCode>32?String.fromCharCode(n.charCode):null;t&&(!i.activeEditor||e._startingEditing?e._editChar=t:e._editChar&&(e._editChar+=t))},!0),i.hostElement.addEventListener('compositionstart',function(){e._composing=!0},!0),i.hostElement.addEventListener('compositionend',function(){e._composing=!1},!0),i.updatedView.addHandler(function(){f._needsCdCheck&&(f._needsCdCheck=!1,f._gridCdRef.markForCheck())},f),f}return p(t,n),t.prototype.updateCell=function(n,i,u,s,h){var ft=this,pt,ot,st,b,y,v,wt,bt,ht,kt,lt,at,g,vt,yt;this._cellStampCounter=(this._cellStampCounter+1)%1e7;pt=s[t._cellStampProp]=this._cellStampCounter;s.style.overflow&&(s.style.overflow='');var nt=this,l=n.grid,et=l.editRange,c,k=n.rows[i],tt=k.dataItem,it=!1,rt=!1,p=!1,ut=!1;switch(n.cellType){case f.CellType.Cell:et&&et.row===i&&et.col===u?(c=r.CellEdit,rt=p=!0):k instanceof f.GroupRow?(ut=tt instanceof e.CollectionViewGroup,ot=!(ut||k.hasChildren),u==n.columns.firstVisibleIndex?c=ot?r.Cell:r.GroupHeader:(c=ot?r.Cell:r.Group,rt=!0)):k instanceof f._NewRowTemplate?c=r.NewCellTemplate:w()&&w().DetailRow&&k instanceof w().DetailRow||(c=r.Cell);break;case f.CellType.ColumnHeader:c=r.ColumnHeader;break;case f.CellType.RowHeader:c=l.collectionView&&l.collectionView.currentEditItem===tt?r.RowHeaderEdit:r.RowHeader;it=!0;break;case f.CellType.TopLeft:c=r.TopLeft;it=!0;break;case f.CellType.ColumnFooter:c=r.ColumnFooter;rt=!0;break;case f.CellType.BottomLeft:c=r.BottomLeft;it=!0}if(st=!1,c!=null&&(b=ut&&c==r.GroupHeader?l.columns.getColumn(tt.groupDescription.propertyName):u>=0&&u<n.columns.length?n.columns[u]:null,b&&(y=o._getTemplContextProp(c),v=(it?l:b)[y],v||(c===r.RowHeaderEdit?(c=r.RowHeader,y=o._getTemplContextProp(c),v=l[y]):(c===r.Group||c===r.GroupHeader)&&(ut||(c=r.Cell,y=o._getTemplContextProp(c),v=b[y]))),v&&(wt=!0,rt&&(bt=n.getCellData(i,u,!1)),wt)))){st=!0;ht=s.getAttribute(f.FlexGrid._WJS_MEASURE);kt=ht&&ht.toLowerCase()==='true';p&&this._baseCf.updateCell(n,i,u,s,h,!0);var a=s[y]||{},dt=a.column!==b||!a.viewRef||a.templateContextProperty!==y||s.firstChild!=a.rootElement,ct=p&&this._composing&&l.imeEnabled;dt&&(p?(lt=s.firstElementChild,lt&&(ct||s.focus(),lt.style.display='none')):s.textContent='',this._doDisposeCell(s),at=v._instantiateTemplate(s),a.column=b,a.viewRef=at.viewRef,a.rootElement=at.rootElement,a.templateContextProperty=y,s[y]=a);g=this._setViewRefVars(a.viewRef,k,b,tt,bt,v.valuePaths);v.cellOverflow&&(s.style.overflow=v.cellOverflow);kt?v.cdRef.detectChanges():v.autoSizeRows&&!ct?setTimeout(function(){if(pt===s[t._cellStampProp]){var u=s.scrollHeight,r=n.rows,f=h&&h.rowSpan||1;if(i<r.length&&r[i].renderHeight*f<u-1){if(r.defaultSize=u/f,p){l.refresh();l.startEditing();return}}else p&&ft._initEditInput(a,null)}},0):p&&setTimeout(function(){ct?ft._initImeEditInput(a):ft._initEditInput(a,null)},0);p?(nt._cellEditorVars=g.localVars,vt=function(n,t){var r,o,h,i,u,f,c;if(l.cellEditEnding.removeHandler(vt),t.stayInEditMode||(r=e.getActiveElement(),r&&r.dispatchEvent(nt._evtBlur),s.focus()),nt._triggerEditorEvents(s),!(t.cancel||t.stayInEditMode))for(o=g.localVars,h=Object.getOwnPropertyNames(g.bindings),i=0,u=h;i<u.length;i++)f=u[i],g.bindings[f].setValue(o,g.localVars.values[f]);c=s.querySelectorAll('.wj-dropdown');[].forEach.call(c,function(n){var t=e.Control.getControl(n);t&&d()&&t instanceof d().DropDown&&(t.isDroppedDown=!1)})},yt=function(){l.cellEditEnded.removeHandler(yt);nt._cellEditorVars=null},l.cellEditEnding.addHandler(vt),l.cellEditEnded.addHandler(yt)):this._baseCf.updateCell(n,i,u,s,h,!1)}st||(this._doDisposeCell(s),this._baseCf.updateCell(n,i,u,s,h))},t.prototype.getEditorValue=function(t){if(this._cellEditorVars){var i=t.editRange;return i&&i.isValid&&this._triggerEditorEvents(t.cells.getCellElement(i.row,i.col)),this._cellEditorVars.value}return n.prototype.getEditorValue.call(this,t)},t.prototype.disposeCell=function(n){this._doDisposeCell(n)},t.prototype._doDisposeCell=function(n){for(var u,i,c,f,s,h=t._templateTypes,e=0;e<h.length;e++)u=o._getTemplContextProp(r[h[e]]),i=n[u],i&&i.viewRef&&(c=i.column||this.grid,f=c[u],f&&(s=f.viewContainerRef.indexOf(i.viewRef),s>-1&&f.viewContainerRef.remove(s)),i.viewRef=null,i.rootElement=null,i.column=null,i.templateContextProperty=null,n[u]=null)},t.prototype._setViewRefVars=function(n,t,i,r,u,f){var y,s,c,h,l;this._needsCdCheck=!0;n.context.row=t;n.context.col=i;n.context.item=r;var a={},o=n.context.cell||{},v={},p={localVars:o,bindings:v};if(o.row=t,o.col=i,o.item=r,o.value=u,o.values=a,f)for(y=Object.getOwnPropertyNames(f),s=0,c=y;s<c.length;s++)h=c[s],l=new e.Binding(f[h]),v[h]=l,a[h]=l.getValue(o);return n.context.cell!==o&&(n.context.cell=o),p},t.prototype._initEditInput=function(n,t){var r=this,i=this._findInitialInput(n),f=window.getComputedStyle(i),u;f.display!=='none'&&f.visibility==='visible'&&(u=function(){i.removeEventListener('focus',u);setTimeout(function(){setTimeout(function(){var n=t!=null?t:r._editChar,u,f;n&&(u=!0,f=i.selectionStart+n.length,i.value=n,r._editChar=null,i.dispatchEvent(r._evtInput),u&&setTimeout(function(){setTimeout(function(){e.setSelectionRange(i,Math.min(f,i.value.length),i.value.length)},0)},0))},0)},0)},i.addEventListener('focus',u),i.focus())},t.prototype._initImeEditInput=function(n){var h=this,t=e.getActiveElement(),r,u;if(t&&t instanceof HTMLInputElement&&e.hasClass(t,'wj-grid-ime')&&(r=function(){t.removeEventListener('compositionend',r);e.setCss(t,f._ImeHandler._cssHidden);h._initEditInput(n,t.value)},t.addEventListener('compositionend',r),u=this._findInitialInput(n),u)){var i=u.getBoundingClientRect(),o=t.getBoundingClientRect(),s=window.getComputedStyle(t),c=parseFloat(s.left),l=parseFloat(s.top);e.setCss(t,{left:c+i.left-o.left+'px',top:l+i.top-o.top+'px',width:i.width+'px',height:i.height+'px'})}},t.prototype._findInitialInput=function(n){var i=n&&n.rootElement&&n.rootElement.querySelectorAll('input'),t,r,u;if(i)for(t=0;t<i.length;t++)if(r=i[t],u=window.getComputedStyle(r),u.display!=='none'&&u.visibility==='visible')return r;return null},t.prototype._triggerEditorEvents=function(n){var i,t,f,r,u;if(n)for(i=n.querySelectorAll('.wj-control'),t=0;t<i.length;t++)f=i[t],r=e.Control.getControl(f),r&&(u=s.WjDirectiveBehavior.getBehavior(r),u&&u.flushPendingEvents())},t}(f.CellFactory);b._cellStampProp='__wjCellStamp';k=[h,c,o];y=function(){function n(){}return n}();y.decorators=[{type:v.NgModule,args:[{imports:[s.WjDirectiveBaseModule,g.CommonModule],declarations:k.slice(),exports:k.slice()},]},];y.ctorParameters=function(){return[]};n("WjGridModule",y)}}})