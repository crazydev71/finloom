/*
    *
    * Wijmo Library 5.20172.359
    * http://wijmo.com/
    *
    * Copyright(c) GrapeCity, Inc.  All rights reserved.
    *
    * Licensed under the GrapeCity Commercial License.
    * sales@wijmo.com
    * wijmo.com/products/wijmo-5/license/
    *
    */
"use strict";var _CanvasRenderEngine,_GradientColorUtil,_exportFn;Object.defineProperty(exports,"__esModule",{value:!0});var wjcChart=require("wijmo/wijmo.chart"),wjcCore=require("wijmo/wijmo"),wjcSelf=require("wijmo/wijmo.chart.render");window.wijmo=window.wijmo||{};window.wijmo.chart=window.wijmo.chart||{};window.wijmo.chart.render=wjcSelf;_CanvasRenderEngine=function(){function n(n,t){t===void 0&&(t=!1);this._strokeWidth=1;this._fontSize=null;this._fontFamily=null;this._applyCanvasClip=function(n,t){var i=this._canvasRect[t];i&&(n.beginPath(),n.rect(i.left,i.top,i.width,i.height),n.clip(),n.closePath())};this._applyCanvasStyles=function(n,t,i,r,u){var e=this,o=e._canvas.getContext('2d'),s,f,l,c=e.stroke,h=e.fill,a=e.strokeWidth;t&&t.stroke!==undefined&&(c=t.stroke);t&&t.fill!==undefined&&(h=e._getOpacityColor(t.fill,t['fill-opacity']));n&&(f=window.getComputedStyle(n),l=n.getBBox());u?f?(o.fillStyle=f.fill,s=f.fontStyle+' '+f.fontSize+' '+f.fontFamily,o.font=s,o.font.replace(/\"/g,"'")!==s.replace(/\"/g,"'")&&(s=f.fontStyle+' '+f.fontSize+' '+(o.font.split(' ')[1]||'sans-serif'),o.font=s)):e.fontSize?(o.fillStyle=e.textFill,o.font=e.fontSize+' '+(e.fontFamily||'sans-serif')):e._canvasDefaultFont&&(o.fillStyle=e._canvasDefaultFont.textFill,s=e._canvasDefaultFont.fontSize+' '+e._canvasDefaultFont.fontFamily,o.font=s,o.font.replace(/\"/g,"'")!==s.replace(/\"/g,"'")&&(s=e._canvasDefaultFont.fontSize+' '+(o.font.split(' ')[1]||'sans-serif'),o.font=s)):(f&&(c=f.stroke&&f.stroke!=='none'?f.stroke:c,h=f.fill&&f.fill!=='none'?e._getOpacityColor(f.fill,f['fill-opacity']):h,a=f.strokeWidth?f.strokeWidth:a),c!=='none'&&c!=null&&(this._applyColor('strokeStyle',c,l),o.lineWidth=+a.replace(/px/g,''),o.stroke()),r&&h!=null&&h!=='transparent'&&h!=='none'&&(this._applyColor('fillStyle',h,l),o.fill()))};var i=this;i._element=n;i._canvas=document.createElement('canvas');i._svgEngine=new wjcChart._SvgRenderEngine(n);i._element.appendChild(i._canvas);i._applyCSSStyles=t}return n.prototype.beginRender=function(){var n=this,i=n._svgEngine.element,r=n._element,t;n._applyCSSStyles&&(n._svgEngine.beginRender(),r=i);n._element.appendChild(i);n._canvasRect={};t=window.getComputedStyle(r);n._canvasDefaultFont={fontSize:t.fontSize,fontFamily:t.fontFamily,textFill:t.color}},n.prototype.endRender=function(){this._applyCSSStyles&&this._svgEngine.endRender();this._svgEngine.element.parentNode.removeChild(this._svgEngine.element)},n.prototype.setViewportSize=function(n,t){var i=this,r=i._canvas,o=r.getContext('2d'),e=i.fill,u,f;i._applyCSSStyles&&i._svgEngine.setViewportSize(n,t);r.width=n;r.height=t;u=window.getComputedStyle(i._element).backgroundColor;f=i.stroke;u&&(i.stroke=null,i.fill=u,i.drawRect(0,0,n,t),i.fill=e,i.stroke=f)},Object.defineProperty(n.prototype,"element",{get:function(){return this._canvas},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"fill",{get:function(){return this._fill},set:function(n){this._svgEngine.fill=n;this._fill=n},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"fontSize",{get:function(){return this._fontSize},set:function(n){this._svgEngine.fontSize=n;var t=n==null||isNaN(n)?n:n+'px';this._fontSize=t},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"fontFamily",{get:function(){return this._fontFamily},set:function(n){this._svgEngine.fontFamily=n;this._fontFamily=n},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"stroke",{get:function(){return this._stroke},set:function(n){this._svgEngine.stroke=n;this._stroke=n},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"strokeWidth",{get:function(){return this._strokeWidth},set:function(n){this._svgEngine.strokeWidth=n;this._strokeWidth=n},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"textFill",{get:function(){return this._textFill},set:function(n){this._svgEngine.textFill=n;this._textFill=n},enumerable:!0,configurable:!0}),n.prototype.addClipRect=function(n,t){n&&t&&(this._applyCSSStyles&&this._svgEngine.addClipRect(n,t),this._canvasRect[t]=n)},n.prototype.drawEllipse=function(n,t,i,r,u,f){var o,e=this._canvas.getContext('2d');return this._applyCSSStyles&&(o=this._svgEngine.drawEllipse(n,t,i,r,u,f)),e.save(),e.beginPath(),e.ellipse?e.ellipse(n,t,i,r,0,0,2*Math.PI):(e.translate(n,t),e.scale(1,r/i),e.translate(-n,-t),e.arc(n,t,i,0,2*Math.PI),e.scale(1,1)),this._applyCanvasStyles(o,f,u,!0),e.restore(),o},n.prototype.drawRect=function(n,t,i,r,u,f,e){var s,o=this._canvas.getContext('2d');return this._applyCSSStyles&&(s=this._svgEngine.drawRect(n,t,i,r,u,f,e)),o.save(),this._applyCanvasClip(o,e),o.beginPath(),o.rect(n,t,i,r),this._applyCanvasStyles(s,f,u,!0),o.restore(),s},n.prototype.drawLine=function(n,t,i,r,u,f){var o,e=this._canvas.getContext('2d');return this._applyCSSStyles&&(o=this._svgEngine.drawLine(n,t,i,r,u,f)),e.save(),e.beginPath(),e.moveTo(n,t),e.lineTo(i,r),this._applyCanvasStyles(o,f,u),e.restore(),o},n.prototype.drawLines=function(n,t,i,r,u){if(n&&t&&n.length!==0&&t.length!==0){var f=this._canvas.getContext('2d'),s=Math.min(n.length,t.length),o,e;for(this._applyCSSStyles&&(o=this._svgEngine.drawLines([0,1],[1,0],i,r,u)),f.save(),this._applyCanvasClip(f,u),f.beginPath(),f.moveTo(n[0],t[0]),e=1;e<s;e++)f.lineTo(n[e],t[e]);return this._applyCanvasStyles(o,r,i),f.restore(),o}},n.prototype.drawSplines=function(n,t,i,r,u){if(n&&t&&n.length!==0&&t.length!==0){var f=this._canvas.getContext('2d'),l=new wjcChart._Spline(n,t),c=l.calculate(),o=c.xs,s=c.ys,a=Math.min(o.length,s.length),h,e;for(this._applyCSSStyles&&(h=this._svgEngine.drawSplines([0,1],[1,0],i,r,u)),f.save(),this._applyCanvasClip(f,u),f.beginPath(),f.moveTo(o[0],s[0]),e=1;e<a;e++)f.lineTo(o[e],s[e]);return this._applyCanvasStyles(h,r,i),f.restore(),h}},n.prototype.drawPolygon=function(n,t,i,r,u){if(n&&t&&n.length!==0&&t.length!==0){var f=this._canvas.getContext('2d'),s=Math.min(n.length,t.length),o,e;for(this._applyCSSStyles&&(o=this._svgEngine.drawPolygon(n,t,i,r,u)),f.save(),this._applyCanvasClip(f,u),f.beginPath(),f.moveTo(n[0],t[0]),e=1;e<s;e++)f.lineTo(n[e],t[e]);return f.closePath(),this._applyCanvasStyles(o,r,i,!0),f.restore(),o}},n.prototype.drawPieSegment=function(n,t,i,r,u,f,e,o){var h,s=this._canvas.getContext('2d'),c=r,l=r+u;return this._applyCSSStyles&&(h=this._svgEngine.drawPieSegment(n,t,i,r,u,f,e,o)),s.save(),this._applyCanvasClip(s,o),s.beginPath(),s.moveTo(n,t),s.arc(n,t,i,c,l,!1),s.lineTo(n,t),this._applyCanvasStyles(h,e,f,!0),s.restore(),h},n.prototype.drawDonutSegment=function(n,t,i,r,u,f,e,o,s){var h=this._canvas.getContext('2d'),a=u,v=u+f,y,c,l;return this._applyCSSStyles&&(y=this._svgEngine.drawDonutSegment(n,t,i,r,u,f,e,o,s)),c=new wjcCore.Point(n,t),c.x+=r*Math.cos(a),c.y+=r*Math.sin(a),l=new wjcCore.Point(n,t),l.x+=r*Math.cos(v),l.y+=r*Math.sin(v),h.save(),this._applyCanvasClip(h,s),h.beginPath(),h.moveTo(c.x,c.y),h.arc(n,t,i,a,v,!1),h.lineTo(l.x,l.y),h.arc(n,t,r,v,a,!0),this._applyCanvasStyles(y,o,e,!0),h.restore(),y},n.prototype.drawString=function(n,t,i,r){var f,u=this._canvas.getContext('2d');return this._applyCSSStyles&&(f=this._svgEngine.drawString(n,t,i,r)),u.save(),u.textBaseline='bottom',this._applyCanvasStyles(f,r,i,!0,!0),u.fillText(n,t.x,t.y),u.restore(),f},n.prototype.drawStringRotated=function(n,t,i,r,u,f){var o,e=this._canvas.getContext('2d'),s=e.measureText(n);return this._applyCSSStyles&&(o=this._svgEngine.drawStringRotated(n,t,i,r,u,f)),e.save(),e.textBaseline='bottom',e.translate(i.x,i.y),e.rotate(Math.PI/180*r),e.translate(-i.x,-i.y),this._applyCanvasStyles(o,f,u,!0,!0),e.fillText(n,t.x,t.y),e.restore(),o},n.prototype.measureString=function(n,t,i,r){var u=u=this._canvas.getContext('2d'),f;return this._applyCSSStyles?this._svgEngine.measureString(n,t,i,r):(this._applyCanvasStyles(null,null,t,!0,!0),f=u.measureText(n).width,new wjcCore.Size(f,parseInt(u.font)*1.5))},n.prototype.startGroup=function(n,t,i){i===void 0&&(i=!1);var r,u=this._canvas.getContext('2d');return this._applyCSSStyles&&(r=this._svgEngine.startGroup(n,t,i)),u.save(),this._applyCanvasClip(u,t),r},n.prototype.endGroup=function(){this._applyCSSStyles&&this._svgEngine.endGroup();this._canvas.getContext('2d').restore()},n.prototype.drawImage=function(n,t,i,r,u){var e,o=this._canvas.getContext('2d'),f=new Image;return this._applyCSSStyles&&(e=this._svgEngine.drawImage(n,t,i,r,u)),f.onload=function(){o.drawImage(f,t,i,r,u)},f.src=n,e},n.prototype._getOpacityColor=function(n,t){var i=new wjcCore.Color(n);return n.indexOf('url')>-1?this.fill:n.indexOf('-')>-1?(this.fill=n,n):(t!=null&&i.a===1&&(i.a=isNaN(t)?1:Number(t)),i.toString())},n.prototype._applyColor=function(n,t,i){var r=_GradientColorUtil.tryParse(t),u=this._canvas.getContext('2d'),f,s,h;if(r!=null)if(wjcCore.isString(r)||i==null)u[n]=r;else{if(s=void 0,h=void 0,r.x1!=null)f=r.relative?u.createLinearGradient(i.x+r.x1*i.width,i.y+r.y1*i.height,i.x+r.x2*i.width,i.y+r.y2*i.height):u.createLinearGradient(r.x1,r.y1,r.x2,r.y2);else if(r.r!=null)if(r.relative){var c=i.x+r.cx*i.width,l=i.y+r.cy*i.height,o=r.r*i.width,a=r.r*i.height,e=a/o,v=i.x+(r.fx==null?r.cx:r.fx)*i.width,y=i.y+(r.fy==null?r.cy:r.fy)*i.height,p=(r.fr==null?0:r.fr)*i.width,w=(r.fr==null?0:r.fr)*i.height,b=Math.min(p,w);f=u.createRadialGradient(v,y/e,b,c,l/e,o);u.setTransform(1,0,0,e,0,0)}else f=u.createRadialGradient(r.fx==null?r.cx:r.fx,r.fy==null?r.cy:r.fy,r.fr||0,r.cx,r.cy,r.r);r.colors&&r.colors.length>0&&f!=null&&r.colors.forEach(function(n){var t=new wjcCore.Color('#000000');n.color!=null&&(t=n.color);n.opacity!=null&&(t.a=n.opacity);f.addColorStop(n.offset,t.toString())});u[n]=f}},n}();exports._CanvasRenderEngine=_CanvasRenderEngine;_GradientColorUtil=function(){function n(){}return n.tryParse=function(t){var o;if(n.parsedColor[t])return n.parsedColor[t];if(t==null||t.indexOf('-')===-1)return t;var f=t.replace(/\s+/g,'').split(/\-/g),r=f[0][0],e=!1,i,u=f[0].match(/\(\S+\)/)[0].replace(/[\(\\)]/g,'').split(/\,/g);return r==='l'||r==='L'?(i={x1:'0',y1:'0',x2:'0',y2:'0',colors:[]},r==='l'&&(e=!0),['x1','y1','x2','y2'].forEach(function(n,t){u[t]!=null&&(i[n]=+u[t])})):(r==='r'||r==='R')&&(i={cx:'0',cy:'0',r:'0',colors:[]},r==='r'&&(e=!0),['cx','cy','r','fx','fy','fr'].forEach(function(n,t){u[t]!=null&&u[t]!==''&&(i[n]=+u[t])})),i.relative=e,n.parsedColor[t]=i,o=f.length-1,f.forEach(function(n,t){n.indexOf(')')>-1&&(n=n.match(/\)\S+/)[0].replace(')',''));var r=n.split(':'),u={color:new wjcCore.Color('#000000')};r[0]!=null&&(u.color=wjcCore.Color.fromString(r[0]));u.offset=r[1]!=null?+r[1]:t/o;r[2]!=null&&(u.opacity=+r[2]);i.colors.push(u)}),i},n}();_GradientColorUtil.parsedColor={};wjcChart.FlexChartBase&&wjcChart.FlexChartBase.prototype&&wjcChart.FlexChartBase.prototype._exportToImage&&(_exportFn=wjcChart.FlexChartBase.prototype._exportToImage,wjcChart.FlexChartBase.prototype._exportToImage=function(n,t){if(n==='svg'){_exportFn.call(this,n,t);return}var r=new _CanvasRenderEngine(this.hostElement,!0),f=this.rendered,u,i;this.rendered=new wjcCore.Event;this._render(r,!1);i=r.element;i.parentNode.removeChild(i);u=i.toDataURL('image/'+n);t.call(null,u);i=null;r=null;this.rendered=f})