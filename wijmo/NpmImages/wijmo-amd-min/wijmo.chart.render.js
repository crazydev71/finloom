/*
    *
    * Wijmo Library 5.20172.359
    * http://wijmo.com/
    *
    * Copyright(c) GrapeCity, Inc.  All rights reserved.
    *
    * Licensed under the GrapeCity Commercial License.
    * sales@wijmo.com
    * wijmo.com/products/wijmo-5/license/
    *
    */
define(["require","exports","wijmo/wijmo.chart","wijmo/wijmo","wijmo/wijmo.chart.render"],function(n,t,i,r,u){"use strict";var f,e,o;Object.defineProperty(t,"__esModule",{value:!0});window.wijmo=window.wijmo||{};window.wijmo.chart=window.wijmo.chart||{};window.wijmo.chart.render=u;f=function(){function n(n,t){t===void 0&&(t=!1);this._strokeWidth=1;this._fontSize=null;this._fontFamily=null;this._applyCanvasClip=function(n,t){var i=this._canvasRect[t];i&&(n.beginPath(),n.rect(i.left,i.top,i.width,i.height),n.clip(),n.closePath())};this._applyCanvasStyles=function(n,t,i,r,u){var e=this,o=e._canvas.getContext('2d'),s,f,l,c=e.stroke,h=e.fill,a=e.strokeWidth;t&&t.stroke!==undefined&&(c=t.stroke);t&&t.fill!==undefined&&(h=e._getOpacityColor(t.fill,t['fill-opacity']));n&&(f=window.getComputedStyle(n),l=n.getBBox());u?f?(o.fillStyle=f.fill,s=f.fontStyle+' '+f.fontSize+' '+f.fontFamily,o.font=s,o.font.replace(/\"/g,"'")!==s.replace(/\"/g,"'")&&(s=f.fontStyle+' '+f.fontSize+' '+(o.font.split(' ')[1]||'sans-serif'),o.font=s)):e.fontSize?(o.fillStyle=e.textFill,o.font=e.fontSize+' '+(e.fontFamily||'sans-serif')):e._canvasDefaultFont&&(o.fillStyle=e._canvasDefaultFont.textFill,s=e._canvasDefaultFont.fontSize+' '+e._canvasDefaultFont.fontFamily,o.font=s,o.font.replace(/\"/g,"'")!==s.replace(/\"/g,"'")&&(s=e._canvasDefaultFont.fontSize+' '+(o.font.split(' ')[1]||'sans-serif'),o.font=s)):(f&&(c=f.stroke&&f.stroke!=='none'?f.stroke:c,h=f.fill&&f.fill!=='none'?e._getOpacityColor(f.fill,f['fill-opacity']):h,a=f.strokeWidth?f.strokeWidth:a),c!=='none'&&c!=null&&(this._applyColor('strokeStyle',c,l),o.lineWidth=+a.replace(/px/g,''),o.stroke()),r&&h!=null&&h!=='transparent'&&h!=='none'&&(this._applyColor('fillStyle',h,l),o.fill()))};var r=this;r._element=n;r._canvas=document.createElement('canvas');r._svgEngine=new i._SvgRenderEngine(n);r._element.appendChild(r._canvas);r._applyCSSStyles=t}return n.prototype.beginRender=function(){var n=this,i=n._svgEngine.element,r=n._element,t;n._applyCSSStyles&&(n._svgEngine.beginRender(),r=i);n._element.appendChild(i);n._canvasRect={};t=window.getComputedStyle(r);n._canvasDefaultFont={fontSize:t.fontSize,fontFamily:t.fontFamily,textFill:t.color}},n.prototype.endRender=function(){this._applyCSSStyles&&this._svgEngine.endRender();this._svgEngine.element.parentNode.removeChild(this._svgEngine.element)},n.prototype.setViewportSize=function(n,t){var i=this,r=i._canvas,o=r.getContext('2d'),e=i.fill,u,f;i._applyCSSStyles&&i._svgEngine.setViewportSize(n,t);r.width=n;r.height=t;u=window.getComputedStyle(i._element).backgroundColor;f=i.stroke;u&&(i.stroke=null,i.fill=u,i.drawRect(0,0,n,t),i.fill=e,i.stroke=f)},Object.defineProperty(n.prototype,"element",{get:function(){return this._canvas},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"fill",{get:function(){return this._fill},set:function(n){this._svgEngine.fill=n;this._fill=n},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"fontSize",{get:function(){return this._fontSize},set:function(n){this._svgEngine.fontSize=n;var t=n==null||isNaN(n)?n:n+'px';this._fontSize=t},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"fontFamily",{get:function(){return this._fontFamily},set:function(n){this._svgEngine.fontFamily=n;this._fontFamily=n},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"stroke",{get:function(){return this._stroke},set:function(n){this._svgEngine.stroke=n;this._stroke=n},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"strokeWidth",{get:function(){return this._strokeWidth},set:function(n){this._svgEngine.strokeWidth=n;this._strokeWidth=n},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"textFill",{get:function(){return this._textFill},set:function(n){this._svgEngine.textFill=n;this._textFill=n},enumerable:!0,configurable:!0}),n.prototype.addClipRect=function(n,t){n&&t&&(this._applyCSSStyles&&this._svgEngine.addClipRect(n,t),this._canvasRect[t]=n)},n.prototype.drawEllipse=function(n,t,i,r,u,f){var o,e=this._canvas.getContext('2d');return this._applyCSSStyles&&(o=this._svgEngine.drawEllipse(n,t,i,r,u,f)),e.save(),e.beginPath(),e.ellipse?e.ellipse(n,t,i,r,0,0,2*Math.PI):(e.translate(n,t),e.scale(1,r/i),e.translate(-n,-t),e.arc(n,t,i,0,2*Math.PI),e.scale(1,1)),this._applyCanvasStyles(o,f,u,!0),e.restore(),o},n.prototype.drawRect=function(n,t,i,r,u,f,e){var s,o=this._canvas.getContext('2d');return this._applyCSSStyles&&(s=this._svgEngine.drawRect(n,t,i,r,u,f,e)),o.save(),this._applyCanvasClip(o,e),o.beginPath(),o.rect(n,t,i,r),this._applyCanvasStyles(s,f,u,!0),o.restore(),s},n.prototype.drawLine=function(n,t,i,r,u,f){var o,e=this._canvas.getContext('2d');return this._applyCSSStyles&&(o=this._svgEngine.drawLine(n,t,i,r,u,f)),e.save(),e.beginPath(),e.moveTo(n,t),e.lineTo(i,r),this._applyCanvasStyles(o,f,u),e.restore(),o},n.prototype.drawLines=function(n,t,i,r,u){if(n&&t&&n.length!==0&&t.length!==0){var f=this._canvas.getContext('2d'),s=Math.min(n.length,t.length),o,e;for(this._applyCSSStyles&&(o=this._svgEngine.drawLines([0,1],[1,0],i,r,u)),f.save(),this._applyCanvasClip(f,u),f.beginPath(),f.moveTo(n[0],t[0]),e=1;e<s;e++)f.lineTo(n[e],t[e]);return this._applyCanvasStyles(o,r,i),f.restore(),o}},n.prototype.drawSplines=function(n,t,r,u,f){if(n&&t&&n.length!==0&&t.length!==0){var e=this._canvas.getContext('2d'),a=new i._Spline(n,t),l=a.calculate(),s=l.xs,h=l.ys,v=Math.min(s.length,h.length),c,o;for(this._applyCSSStyles&&(c=this._svgEngine.drawSplines([0,1],[1,0],r,u,f)),e.save(),this._applyCanvasClip(e,f),e.beginPath(),e.moveTo(s[0],h[0]),o=1;o<v;o++)e.lineTo(s[o],h[o]);return this._applyCanvasStyles(c,u,r),e.restore(),c}},n.prototype.drawPolygon=function(n,t,i,r,u){if(n&&t&&n.length!==0&&t.length!==0){var f=this._canvas.getContext('2d'),s=Math.min(n.length,t.length),o,e;for(this._applyCSSStyles&&(o=this._svgEngine.drawPolygon(n,t,i,r,u)),f.save(),this._applyCanvasClip(f,u),f.beginPath(),f.moveTo(n[0],t[0]),e=1;e<s;e++)f.lineTo(n[e],t[e]);return f.closePath(),this._applyCanvasStyles(o,r,i,!0),f.restore(),o}},n.prototype.drawPieSegment=function(n,t,i,r,u,f,e,o){var h,s=this._canvas.getContext('2d'),c=r,l=r+u;return this._applyCSSStyles&&(h=this._svgEngine.drawPieSegment(n,t,i,r,u,f,e,o)),s.save(),this._applyCanvasClip(s,o),s.beginPath(),s.moveTo(n,t),s.arc(n,t,i,c,l,!1),s.lineTo(n,t),this._applyCanvasStyles(h,e,f,!0),s.restore(),h},n.prototype.drawDonutSegment=function(n,t,i,u,f,e,o,s,h){var c=this._canvas.getContext('2d'),v=f,y=f+e,p,l,a;return this._applyCSSStyles&&(p=this._svgEngine.drawDonutSegment(n,t,i,u,f,e,o,s,h)),l=new r.Point(n,t),l.x+=u*Math.cos(v),l.y+=u*Math.sin(v),a=new r.Point(n,t),a.x+=u*Math.cos(y),a.y+=u*Math.sin(y),c.save(),this._applyCanvasClip(c,h),c.beginPath(),c.moveTo(l.x,l.y),c.arc(n,t,i,v,y,!1),c.lineTo(a.x,a.y),c.arc(n,t,u,y,v,!0),this._applyCanvasStyles(p,s,o,!0),c.restore(),p},n.prototype.drawString=function(n,t,i,r){var f,u=this._canvas.getContext('2d');return this._applyCSSStyles&&(f=this._svgEngine.drawString(n,t,i,r)),u.save(),u.textBaseline='bottom',this._applyCanvasStyles(f,r,i,!0,!0),u.fillText(n,t.x,t.y),u.restore(),f},n.prototype.drawStringRotated=function(n,t,i,r,u,f){var o,e=this._canvas.getContext('2d'),s=e.measureText(n);return this._applyCSSStyles&&(o=this._svgEngine.drawStringRotated(n,t,i,r,u,f)),e.save(),e.textBaseline='bottom',e.translate(i.x,i.y),e.rotate(Math.PI/180*r),e.translate(-i.x,-i.y),this._applyCanvasStyles(o,f,u,!0,!0),e.fillText(n,t.x,t.y),e.restore(),o},n.prototype.measureString=function(n,t,i,u){var f=f=this._canvas.getContext('2d'),e;return this._applyCSSStyles?this._svgEngine.measureString(n,t,i,u):(this._applyCanvasStyles(null,null,t,!0,!0),e=f.measureText(n).width,new r.Size(e,parseInt(f.font)*1.5))},n.prototype.startGroup=function(n,t,i){i===void 0&&(i=!1);var r,u=this._canvas.getContext('2d');return this._applyCSSStyles&&(r=this._svgEngine.startGroup(n,t,i)),u.save(),this._applyCanvasClip(u,t),r},n.prototype.endGroup=function(){this._applyCSSStyles&&this._svgEngine.endGroup();this._canvas.getContext('2d').restore()},n.prototype.drawImage=function(n,t,i,r,u){var e,o=this._canvas.getContext('2d'),f=new Image;return this._applyCSSStyles&&(e=this._svgEngine.drawImage(n,t,i,r,u)),f.onload=function(){o.drawImage(f,t,i,r,u)},f.src=n,e},n.prototype._getOpacityColor=function(n,t){var i=new r.Color(n);return n.indexOf('url')>-1?this.fill:n.indexOf('-')>-1?(this.fill=n,n):(t!=null&&i.a===1&&(i.a=isNaN(t)?1:Number(t)),i.toString())},n.prototype._applyColor=function(n,t,i){var u=e.tryParse(t),f=this._canvas.getContext('2d'),o,c,l;if(u!=null)if(r.isString(u)||i==null)f[n]=u;else{if(c=void 0,l=void 0,u.x1!=null)o=u.relative?f.createLinearGradient(i.x+u.x1*i.width,i.y+u.y1*i.height,i.x+u.x2*i.width,i.y+u.y2*i.height):f.createLinearGradient(u.x1,u.y1,u.x2,u.y2);else if(u.r!=null)if(u.relative){var a=i.x+u.cx*i.width,v=i.y+u.cy*i.height,h=u.r*i.width,y=u.r*i.height,s=y/h,p=i.x+(u.fx==null?u.cx:u.fx)*i.width,w=i.y+(u.fy==null?u.cy:u.fy)*i.height,b=(u.fr==null?0:u.fr)*i.width,k=(u.fr==null?0:u.fr)*i.height,d=Math.min(b,k);o=f.createRadialGradient(p,w/s,d,a,v/s,h);f.setTransform(1,0,0,s,0,0)}else o=f.createRadialGradient(u.fx==null?u.cx:u.fx,u.fy==null?u.cy:u.fy,u.fr||0,u.cx,u.cy,u.r);u.colors&&u.colors.length>0&&o!=null&&u.colors.forEach(function(n){var t=new r.Color('#000000');n.color!=null&&(t=n.color);n.opacity!=null&&(t.a=n.opacity);o.addColorStop(n.offset,t.toString())});f[n]=o}},n}();t._CanvasRenderEngine=f;e=function(){function n(){}return n.tryParse=function(t){var s;if(n.parsedColor[t])return n.parsedColor[t];if(t==null||t.indexOf('-')===-1)return t;var e=t.replace(/\s+/g,'').split(/\-/g),u=e[0][0],o=!1,i,f=e[0].match(/\(\S+\)/)[0].replace(/[\(\\)]/g,'').split(/\,/g);return u==='l'||u==='L'?(i={x1:'0',y1:'0',x2:'0',y2:'0',colors:[]},u==='l'&&(o=!0),['x1','y1','x2','y2'].forEach(function(n,t){f[t]!=null&&(i[n]=+f[t])})):(u==='r'||u==='R')&&(i={cx:'0',cy:'0',r:'0',colors:[]},u==='r'&&(o=!0),['cx','cy','r','fx','fy','fr'].forEach(function(n,t){f[t]!=null&&f[t]!==''&&(i[n]=+f[t])})),i.relative=o,n.parsedColor[t]=i,s=e.length-1,e.forEach(function(n,t){n.indexOf(')')>-1&&(n=n.match(/\)\S+/)[0].replace(')',''));var u=n.split(':'),f={color:new r.Color('#000000')};u[0]!=null&&(f.color=r.Color.fromString(u[0]));f.offset=u[1]!=null?+u[1]:t/s;u[2]!=null&&(f.opacity=+u[2]);i.colors.push(f)}),i},n}();e.parsedColor={};i.FlexChartBase&&i.FlexChartBase.prototype&&i.FlexChartBase.prototype._exportToImage&&(o=i.FlexChartBase.prototype._exportToImage,i.FlexChartBase.prototype._exportToImage=function(n,t){if(n==='svg'){o.call(this,n,t);return}var u=new f(this.hostElement,!0),s=this.rendered,e,i;this.rendered=new r.Event;this._render(u,!1);i=u.element;i.parentNode.removeChild(i);e=i.toDataURL('image/'+n);t.call(null,e);i=null;u=null;this.rendered=s})})