/*
    *
    * Wijmo Library 5.20172.359
    * http://wijmo.com/
    *
    * Copyright(c) GrapeCity, Inc.  All rights reserved.
    *
    * Licensed under the GrapeCity Commercial License.
    * sales@wijmo.com
    * wijmo.com/products/wijmo-5/license/
    *
    */
var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}();define(["require","exports","wijmo/wijmo.grid","wijmo/wijmo","@angular/core","@angular/core","@angular/core","@angular/common","@angular/forms","wijmo/wijmo.angular2.directiveBase"],function(n,t,i,r,u,f,e,o,s,h){"use strict";function p(){var n,t;return(n=window.wijmo)&&(t=n.grid)&&t.detail}function k(){var n;return(n=window.wijmo)&&n.input}var a,v,l,c,w,b,y;Object.defineProperty(t,"__esModule",{value:!0});t.wjFlexGridMeta={selector:'wj-flex-grid',template:"<div><ng-content></ng-content></div>",inputs:['wjModelProperty','isDisabled','newRowAtTop','allowAddNew','allowDelete','allowDragging','allowMerging','allowResizing','allowSorting','autoSizeMode','autoGenerateColumns','childItemsPath','groupHeaderFormat','headersVisibility','showSelectedHeaders','showMarquee','itemFormatter','isReadOnly','imeEnabled','mergeManager','selectionMode','showGroups','showSort','showDropDown','showAlternatingRows','showErrors','validateEdits','treeIndent','itemsSource','autoClipboard','frozenRows','frozenColumns','deferResizing','sortRowIndex','stickyHeaders','preserveSelectedState','preserveOutlineState','keyActionTab','keyActionEnter','rowHeaderPath','virtualizationThreshold',],outputs:['initialized','gotFocusNg: gotFocus','lostFocusNg: lostFocus','beginningEditNg: beginningEdit','cellEditEndedNg: cellEditEnded','cellEditEndingNg: cellEditEnding','prepareCellForEditNg: prepareCellForEdit','formatItemNg: formatItem','resizingColumnNg: resizingColumn','resizedColumnNg: resizedColumn','autoSizingColumnNg: autoSizingColumn','autoSizedColumnNg: autoSizedColumn','draggingColumnNg: draggingColumn','draggingColumnOverNg: draggingColumnOver','draggedColumnNg: draggedColumn','sortingColumnNg: sortingColumn','sortedColumnNg: sortedColumn','resizingRowNg: resizingRow','resizedRowNg: resizedRow','autoSizingRowNg: autoSizingRow','autoSizedRowNg: autoSizedRow','draggingRowNg: draggingRow','draggingRowOverNg: draggingRowOver','draggedRowNg: draggedRow','deletingRowNg: deletingRow','deletedRowNg: deletedRow','loadingRowsNg: loadingRows','loadedRowsNg: loadedRows','rowEditStartingNg: rowEditStarting','rowEditStartedNg: rowEditStarted','rowEditEndingNg: rowEditEnding','rowEditEndedNg: rowEditEnded','rowAddedNg: rowAdded','groupCollapsedChangedNg: groupCollapsedChanged','groupCollapsedChangingNg: groupCollapsedChanging','itemsSourceChangedNg: itemsSourceChanged','selectionChangingNg: selectionChanging','selectionChangedNg: selectionChanged','scrollPositionChangedNg: scrollPositionChanged','updatingViewNg: updatingView','updatedViewNg: updatedView','updatingLayoutNg: updatingLayout','updatedLayoutNg: updatedLayout','pastingNg: pasting','pastedNg: pasted','pastingCellNg: pastingCell','pastedCellNg: pastedCell','copyingNg: copying','copiedNg: copied',],providers:[{provide:s.NG_VALUE_ACCESSOR,useFactory:h.WjValueAccessorFactory,multi:!0,deps:['WjComponent']}]};a=function(n){function t(t,i,u,f){var e=n.call(this,h.WjDirectiveBehavior.getHostElement(t,i))||this,o;return e.isInitialized=!1,o=e._wjBehaviour=h.WjDirectiveBehavior.attach(e,t,i,u),new w(e,f),e.deferUpdate(function(){if(e.rows.defaultSize<10){var t=e.hostElement,i=getComputedStyle(t),u=getComputedStyle(document.body),n=parseInt(i.fontSize&&r.contains(document.body,t)?i.fontSize:u.fontSize)*2;e.rows.defaultSize=n;e.columns.defaultSize=n*4;e.columnHeaders.rows.defaultSize=n;e.rowHeaders.columns.defaultSize=Math.round(n*1.25)}}),e.created(),e}return __extends(t,n),t.prototype.created=function(){},t.prototype.ngOnInit=function(){this._wjBehaviour.ngOnInit()},t.prototype.ngAfterViewInit=function(){this._wjBehaviour.ngAfterViewInit()},t.prototype.ngOnDestroy=function(){this._wjBehaviour.ngOnDestroy()},t.prototype.addEventListener=function(t,i,r,u){var o=this,f,e;u===void 0&&(u=!1);f=h.WjDirectiveBehavior;e=f.ngZone;e&&f.outsideZoneEvents[i]?e.runOutsideAngular(function(){n.prototype.addEventListener.call(o,t,i,r,u)}):n.prototype.addEventListener.call(this,t,i,r,u)},t}(i.FlexGrid);a.meta={outputs:t.wjFlexGridMeta.outputs};a.decorators=[{type:u.Component,args:[{selector:t.wjFlexGridMeta.selector,template:t.wjFlexGridMeta.template,inputs:t.wjFlexGridMeta.inputs,outputs:t.wjFlexGridMeta.outputs,providers:[{provide:'WjComponent',useExisting:f.forwardRef(function(){return a})}].concat(t.wjFlexGridMeta.providers)},]},];a.ctorParameters=function(){return[{type:f.ElementRef,decorators:[{type:e.Inject,args:[f.ElementRef,]},]},{type:f.Injector,decorators:[{type:e.Inject,args:[f.Injector,]},]},{type:undefined,decorators:[{type:e.Inject,args:['WjComponent',]},{type:e.SkipSelf},{type:f.Optional},]},{type:e.ChangeDetectorRef,decorators:[{type:e.Inject,args:[e.ChangeDetectorRef,]},]},]};t.WjFlexGrid=a;t.wjFlexGridColumnMeta={selector:'wj-flex-grid-column',template:"<div><ng-content></ng-content></div>",inputs:['asyncBindings','wjProperty','name','dataMap','dataType','binding','sortMemberPath','format','header','width','maxLength','minWidth','maxWidth','align','allowDragging','allowSorting','allowResizing','allowMerging','aggregate','isReadOnly','cssClass','isContentHtml','isSelected','visible','wordWrap','mask','inputType','isRequired','showDropDown','dropDownCssClass',],outputs:['initialized','isSelectedChangePC: isSelectedChange',],providers:[]};v=function(n){function t(t,i,r){var u=n.call(this)||this,e,f;return u.isInitialized=!1,u.wjProperty='columns',e=u._wjBehaviour=h.WjDirectiveBehavior.attach(u,t,i,r),f=e.parentBehavior.directive,f.autoGenerateColumns&&(f.autoGenerateColumns=!1,f.columns.clear()),u.created(),u}return __extends(t,n),t.prototype.created=function(){},t.prototype.ngOnInit=function(){this._wjBehaviour.ngOnInit()},t.prototype.ngAfterViewInit=function(){this._wjBehaviour.ngAfterViewInit()},t.prototype.ngOnDestroy=function(){this._wjBehaviour.ngOnDestroy()},t}(i.Column);v.meta={outputs:t.wjFlexGridColumnMeta.outputs,changeEvents:{'grid.selectionChanged':['isSelected']}};v.decorators=[{type:u.Component,args:[{selector:t.wjFlexGridColumnMeta.selector,template:t.wjFlexGridColumnMeta.template,inputs:t.wjFlexGridColumnMeta.inputs,outputs:t.wjFlexGridColumnMeta.outputs,providers:[{provide:'WjComponent',useExisting:f.forwardRef(function(){return v})}].concat(t.wjFlexGridColumnMeta.providers)},]},];v.ctorParameters=function(){return[{type:f.ElementRef,decorators:[{type:e.Inject,args:[f.ElementRef,]},]},{type:f.Injector,decorators:[{type:e.Inject,args:[f.Injector,]},]},{type:undefined,decorators:[{type:e.Inject,args:['WjComponent',]},{type:e.SkipSelf},{type:f.Optional},]},]};t.WjFlexGridColumn=v;l=function(){function n(n,t,i,r,u,f,e){this.viewContainerRef=n;this.templateRef=t;this.elRef=i;this.domRenderer=u;this.cdRef=e;this.autoSizeRows=!0;r instanceof a?this.grid=r:r instanceof v&&(this.column=r,this.grid=h.WjDirectiveBehavior.getBehavior(r).parentBehavior.directive)}return n._getTemplContextProp=function(n){return'$__cellTempl'+c[n]},n.prototype.ngOnInit=function(){this.ownerControl=this.column&&this.column.grid===this.grid?this.column:this.grid;this._attachToControl()},n.prototype.ngOnDestroy=function(){this.cellTypeStr&&(this.viewContainerRef.clear(),this.ownerControl[n._getTemplContextProp(this.cellType)]=null,this.grid.invalidate())},n.prototype._instantiateTemplate=function(n){return h.WjDirectiveBehavior.instantiateTemplate(n,this.viewContainerRef,this.templateRef,this.domRenderer)},n.prototype._attachToControl=function(){this.cellTypeStr&&(this.cellType=r.asEnum(this.cellTypeStr,c),this.ownerControl[n._getTemplContextProp(this.cellType)]=this,this.grid.invalidate())},n}();l.decorators=[{type:f.Directive,args:[{selector:'[wjFlexGridCellTemplate]',inputs:['wjFlexGridCellTemplate','cellTypeStr: cellType','cellOverflow','valuePaths','autoSizeRows'],exportAs:'wjFlexGridCellTemplate',providers:[{provide:'WjComponent',useExisting:f.forwardRef(function(){return l})}]},]},];l.ctorParameters=function(){return[{type:f.ViewContainerRef,decorators:[{type:e.Inject,args:[f.ViewContainerRef,]},]},{type:f.TemplateRef,decorators:[{type:e.Inject,args:[f.TemplateRef,]},{type:f.Optional},]},{type:f.ElementRef,decorators:[{type:e.Inject,args:[f.ElementRef,]},]},{type:undefined,decorators:[{type:e.Inject,args:['WjComponent',]},{type:e.SkipSelf},{type:f.Optional},]},{type:f.Renderer,decorators:[{type:e.Inject,args:[f.Renderer,]},]},{type:f.Injector,decorators:[{type:e.Inject,args:[f.Injector,]},]},{type:e.ChangeDetectorRef,decorators:[{type:e.Inject,args:[e.ChangeDetectorRef,]},]},]};t.WjFlexGridCellTemplate=l,function(n){n[n.Cell=0]="Cell";n[n.CellEdit=1]="CellEdit";n[n.ColumnHeader=2]="ColumnHeader";n[n.RowHeader=3]="RowHeader";n[n.RowHeaderEdit=4]="RowHeaderEdit";n[n.TopLeft=5]="TopLeft";n[n.GroupHeader=6]="GroupHeader";n[n.Group=7]="Group";n[n.NewCellTemplate=8]="NewCellTemplate";n[n.ColumnFooter=9]="ColumnFooter";n[n.BottomLeft=10]="BottomLeft"}(c=t.CellTemplateType||(t.CellTemplateType={}));w=function(n){function t(i,r){var u=n.call(this)||this,e,f;if(u._needsCdCheck=!1,u._lastApplyTimeStamp=0,u._noApplyLag=!1,u._startingEditing=!1,u._cellStampCounter=0,u._composing=!1,u.grid=i,u._gridCdRef=r,!t._templateTypes){t._templateTypes=[];for(e in c)isNaN(e)&&t._templateTypes.push(e)}return f=u,u._baseCf=i.cellFactory,i.cellFactory=u,u._evtInput=document.createEvent('HTMLEvents'),u._evtInput.initEvent('input',!0,!1),u._evtBlur=document.createEvent('HTMLEvents'),u._evtBlur.initEvent('blur',!1,!1),i.prepareCellForEdit.addHandler(function(){f._noApplyLag=!0}),i.cellEditEnded.addHandler(function(n,t){(t.range.col<0||t.range.col<i.columns.length&&!i.columns[t.range.col][l._getTemplContextProp(c.CellEdit)])&&(f._editChar=null);setTimeout(function(){f._noApplyLag=!1},300)}),i.beginningEdit.addHandler(function(){f._startingEditing=!0}),i.hostElement.addEventListener('keydown',function(){f._startingEditing=!1},!0),i.hostElement.addEventListener('keypress',function(n){var t=n.charCode>32?String.fromCharCode(n.charCode):null;t&&(!i.activeEditor||f._startingEditing?f._editChar=t:f._editChar&&(f._editChar+=t))},!0),i.hostElement.addEventListener('compositionstart',function(){f._composing=!0},!0),i.hostElement.addEventListener('compositionend',function(){f._composing=!1},!0),i.updatedView.addHandler(function(){u._needsCdCheck&&(u._needsCdCheck=!1,u._gridCdRef.markForCheck())},u),u}return __extends(t,n),t.prototype.updateCell=function(n,u,f,e,o){var ft=this,pt,ot,st,b,y,v,wt,bt,ht,kt,lt,at,g,vt,yt;this._cellStampCounter=(this._cellStampCounter+1)%1e7;pt=e[t._cellStampProp]=this._cellStampCounter;e.style.overflow&&(e.style.overflow='');var nt=this,h=n.grid,et=h.editRange,s,d=n.rows[u],tt=d.dataItem,it=!1,rt=!1,w=!1,ut=!1;switch(n.cellType){case i.CellType.Cell:et&&et.row===u&&et.col===f?(s=c.CellEdit,rt=w=!0):d instanceof i.GroupRow?(ut=tt instanceof r.CollectionViewGroup,ot=!(ut||d.hasChildren),f==n.columns.firstVisibleIndex?s=ot?c.Cell:c.GroupHeader:(s=ot?c.Cell:c.Group,rt=!0)):d instanceof i._NewRowTemplate?s=c.NewCellTemplate:p()&&p().DetailRow&&d instanceof p().DetailRow||(s=c.Cell);break;case i.CellType.ColumnHeader:s=c.ColumnHeader;break;case i.CellType.RowHeader:s=h.collectionView&&h.collectionView.currentEditItem===tt?c.RowHeaderEdit:c.RowHeader;it=!0;break;case i.CellType.TopLeft:s=c.TopLeft;it=!0;break;case i.CellType.ColumnFooter:s=c.ColumnFooter;rt=!0;break;case i.CellType.BottomLeft:s=c.BottomLeft;it=!0}if(st=!1,s!=null&&(b=ut&&s==c.GroupHeader?h.columns.getColumn(tt.groupDescription.propertyName):f>=0&&f<n.columns.length?n.columns[f]:null,b&&(y=l._getTemplContextProp(s),v=(it?h:b)[y],v||(s===c.RowHeaderEdit?(s=c.RowHeader,y=l._getTemplContextProp(s),v=h[y]):(s===c.Group||s===c.GroupHeader)&&(ut||(s=c.Cell,y=l._getTemplContextProp(s),v=b[y]))),v&&(wt=!0,rt&&(bt=n.getCellData(u,f,!1)),wt)))){st=!0;ht=e.getAttribute(i.FlexGrid._WJS_MEASURE);kt=ht&&ht.toLowerCase()==='true';w&&this._baseCf.updateCell(n,u,f,e,o,!0);var a=e[y]||{},dt=a.column!==b||!a.viewRef||a.templateContextProperty!==y||e.firstChild!=a.rootElement,ct=w&&this._composing&&h.imeEnabled;dt&&(w?(lt=e.firstElementChild,lt&&(ct||e.focus(),lt.style.display='none')):e.textContent='',this._doDisposeCell(e),at=v._instantiateTemplate(e),a.column=b,a.viewRef=at.viewRef,a.rootElement=at.rootElement,a.templateContextProperty=y,e[y]=a);g=this._setViewRefVars(a.viewRef,d,b,tt,bt,v.valuePaths);v.cellOverflow&&(e.style.overflow=v.cellOverflow);kt?v.cdRef.detectChanges():v.autoSizeRows&&!ct?setTimeout(function(){if(pt===e[t._cellStampProp]){var r=e.scrollHeight,i=n.rows,f=o&&o.rowSpan||1;if(u<i.length&&i[u].renderHeight*f<r-1){if(i.defaultSize=r/f,w){h.refresh();h.startEditing();return}}else w&&ft._initEditInput(a,null)}},0):w&&setTimeout(function(){ct?ft._initImeEditInput(a):ft._initEditInput(a,null)},0);w?(nt._cellEditorVars=g.localVars,vt=function(n,t){var u,s,c,i,f,o,l;if(h.cellEditEnding.removeHandler(vt),t.stayInEditMode||(u=r.getActiveElement(),u&&u.dispatchEvent(nt._evtBlur),e.focus()),nt._triggerEditorEvents(e),!(t.cancel||t.stayInEditMode))for(s=g.localVars,c=Object.getOwnPropertyNames(g.bindings),i=0,f=c;i<f.length;i++)o=f[i],g.bindings[o].setValue(s,g.localVars.values[o]);l=e.querySelectorAll('.wj-dropdown');[].forEach.call(l,function(n){var t=r.Control.getControl(n);t&&k()&&t instanceof k().DropDown&&(t.isDroppedDown=!1)})},yt=function(){h.cellEditEnded.removeHandler(yt);nt._cellEditorVars=null},h.cellEditEnding.addHandler(vt),h.cellEditEnded.addHandler(yt)):this._baseCf.updateCell(n,u,f,e,o,!1)}st||(this._doDisposeCell(e),this._baseCf.updateCell(n,u,f,e,o))},t.prototype.getEditorValue=function(t){if(this._cellEditorVars){var i=t.editRange;return i&&i.isValid&&this._triggerEditorEvents(t.cells.getCellElement(i.row,i.col)),this._cellEditorVars.value}return n.prototype.getEditorValue.call(this,t)},t.prototype.disposeCell=function(n){this._doDisposeCell(n)},t.prototype._doDisposeCell=function(n){for(var r,i,s,u,e,o=t._templateTypes,f=0;f<o.length;f++)r=l._getTemplContextProp(c[o[f]]),i=n[r],i&&i.viewRef&&(s=i.column||this.grid,u=s[r],u&&(e=u.viewContainerRef.indexOf(i.viewRef),e>-1&&u.viewContainerRef.remove(e)),i.viewRef=null,i.rootElement=null,i.column=null,i.templateContextProperty=null,n[r]=null)},t.prototype._setViewRefVars=function(n,t,i,u,f,e){var y,s,c,h,l;this._needsCdCheck=!0;n.context.row=t;n.context.col=i;n.context.item=u;var a={},o=n.context.cell||{},v={},p={localVars:o,bindings:v};if(o.row=t,o.col=i,o.item=u,o.value=f,o.values=a,e)for(y=Object.getOwnPropertyNames(e),s=0,c=y;s<c.length;s++)h=c[s],l=new r.Binding(e[h]),v[h]=l,a[h]=l.getValue(o);return n.context.cell!==o&&(n.context.cell=o),p},t.prototype._initEditInput=function(n,t){var u=this,i=this._findInitialInput(n),e=window.getComputedStyle(i),f;e.display!=='none'&&e.visibility==='visible'&&(f=function(){i.removeEventListener('focus',f);setTimeout(function(){setTimeout(function(){var n=t!=null?t:u._editChar,f,e;n&&(f=!0,e=i.selectionStart+n.length,i.value=n,u._editChar=null,i.dispatchEvent(u._evtInput),f&&setTimeout(function(){setTimeout(function(){r.setSelectionRange(i,Math.min(e,i.value.length),i.value.length)},0)},0))},0)},0)},i.addEventListener('focus',f),i.focus())},t.prototype._initImeEditInput=function(n){var h=this,t=r.getActiveElement(),f,e;if(t&&t instanceof HTMLInputElement&&r.hasClass(t,'wj-grid-ime')&&(f=function(){t.removeEventListener('compositionend',f);r.setCss(t,i._ImeHandler._cssHidden);h._initEditInput(n,t.value)},t.addEventListener('compositionend',f),e=this._findInitialInput(n),e)){var u=e.getBoundingClientRect(),o=t.getBoundingClientRect(),s=window.getComputedStyle(t),c=parseFloat(s.left),l=parseFloat(s.top);r.setCss(t,{left:c+u.left-o.left+'px',top:l+u.top-o.top+'px',width:u.width+'px',height:u.height+'px'})}},t.prototype._findInitialInput=function(n){var i=n&&n.rootElement&&n.rootElement.querySelectorAll('input'),t,r,u;if(i)for(t=0;t<i.length;t++)if(r=i[t],u=window.getComputedStyle(r),u.display!=='none'&&u.visibility==='visible')return r;return null},t.prototype._triggerEditorEvents=function(n){var i,t,e,u,f;if(n)for(i=n.querySelectorAll('.wj-control'),t=0;t<i.length;t++)e=i[t],u=r.Control.getControl(e),u&&(f=h.WjDirectiveBehavior.getBehavior(u),f&&f.flushPendingEvents())},t}(i.CellFactory);w._cellStampProp='__wjCellStamp';b=[a,v,l];y=function(){function n(){}return n}();y.decorators=[{type:u.NgModule,args:[{imports:[h.WjDirectiveBaseModule,o.CommonModule],declarations:b.slice(),exports:b.slice()},]},];y.ctorParameters=function(){return[]};t.WjGridModule=y})